## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 å®šä½

**guix** æ˜¯åŸºäº `racket/gui` çš„è·¨å¹³å°æ¡Œé¢æ§ä»¶åº“ï¼Œä¸ºæŠ€æœ¯å·¥å…·å’Œå¼€å‘è€…å·¥å…·æä¾›ä¸€è‡´ã€å…‹åˆ¶çš„ GUI æ§ä»¶ä½“ç³»ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼ä¸»å¼ 

- **è¡Œä¸ºä¸€è‡´æ€§**ï¼šè·¨å¹³å°äº¤äº’è¡Œä¸ºç»Ÿä¸€ï¼Œä¼˜å…ˆäºè§†è§‰ç»†èŠ‚
- **æŠ€æœ¯ç†æ€§**ï¼šåœ¨ racket/gui æŠ€æœ¯çº¦æŸå†…æä¾›æœ€ä½³å®è·µ
- **æ˜“äºæ‰©å±•**ï¼šå®Œæ•´çš„ä¸»é¢˜ç³»ç»Ÿå’Œæ¸…æ™°çš„æ§ä»¶å±‚æ¬¡
- **å¼€å‘è€…å‹å¥½**ï¼šé¢å‘å·¥å…·ç±»åº”ç”¨ï¼Œè€Œéé€šç”¨æ¶ˆè´¹çº§è½¯ä»¶

### 1.3 æ˜ç¡®è¾¹ç•Œ

**æ ¸å¿ƒç›®æ ‡**

- ç»Ÿä¸€çš„è§†è§‰è¯­è¨€å’Œäº¤äº’æ¨¡å¼
- å®Œæ•´å¯ç»„åˆçš„ä¸»é¢˜ç³»ç»Ÿ
- è¡¥å…… racket/gui ç¼ºå¤±çš„å¸¸ç”¨æ§ä»¶
- æä¾›æœ€ä½³å®è·µå‚è€ƒå®ç°

**éç›®æ ‡ï¼ˆNon-Goalsï¼‰**

- âŒ åƒç´ çº§å¤åˆ»æ“ä½œç³»ç»ŸåŸç”Ÿæ§ä»¶
- âŒ å¼•å…¥ HTML/DOM/CSS èŒƒå¼
- âŒ å®ç°å®Œæ•´æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆIME/æ’¤é”€æ ˆ/å‰ªè´´æ¿ç­‰ç³»ç»Ÿçº§åŠŸèƒ½ï¼‰
- âŒ æä¾›åŠ¨ç”»å¼•æ“æˆ–å¤æ‚è§†è§‰æ•ˆæœ

## äºŒã€è®¾è®¡åŸåˆ™

### 2.1 æ ¸å¿ƒåŸåˆ™

|åŸåˆ™|è¯´æ˜|ç¤ºä¾‹|
|---|---|---|
|**åŠ¡å®ä¼˜å…ˆ**|ä¸¥æ ¼åŸºäº racket/gui èƒ½åŠ›è¾¹ç•Œ|ä¸ä½¿ç”¨ä¸å­˜åœ¨çš„é€æ˜è£å‰ª|
|**è¡Œä¸º > è§†è§‰**|äº¤äº’ä¸€è‡´æ€§é«˜äºå¤–è§‚ç»Ÿä¸€|åŒä¸€æ“ä½œåœ¨æ‰€æœ‰å¹³å°è§¦å‘ç›¸åŒé€»è¾‘|
|**æ‰å¹³ä¼˜å…ˆ**|ç¡¬æœ—æŠ€æœ¯åŒ–é£æ ¼ï¼Œé¿å…å¤æ‚è£…é¥°|ç›´è§’æˆ– â‰¤2px åœ†è§’|
|**è‡ªç»˜ > æ‹¼è£…**|æ•´ä½“äº¤äº’æ§ä»¶å¿…é¡»è‡ªç»˜|list-item ç”¨å• canvasï¼Œé button+label|
|**åˆ†å±‚å®ç°**|æ ¹æ®å¤æ‚åº¦é€‰æ‹©å®ç°ç­–ç•¥|åŸå­æ§ä»¶å¯è‡ªç»˜ï¼Œå®¹å™¨å¯æ‹¼è£…|

### 2.2 æŠ€æœ¯çº¦æŸè®¤çŸ¥

#### racket/gui æ¨¡å‹ç‰¹æ€§

- æ§ä»¶å³åŸç”Ÿçª—å£ï¼Œé DOM èŠ‚ç‚¹
- æ— äº‹ä»¶å†’æ³¡æœºåˆ¶
- æ— é€æ˜è£å‰ªæˆ– z-index
- ç©ºç™½åŒºåŸŸä¸å“åº”äº‹ä»¶
- å­æ§ä»¶ä¸ä»£è¡¨çˆ¶æ§ä»¶æ¥æ”¶äº‹ä»¶

#### è®¾è®¡å«ä¹‰

> **ç”¨æˆ·è§†ä¸º"ä¸€ä¸ªæ•´ä½“"çš„æ§ä»¶ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ª canvas%ï¼Œé€šè¿‡å†…éƒ¨ hit-test åˆ†å‘äº‹ä»¶**

## ä¸‰ã€æ¶æ„è®¾è®¡

### 3.1 ç›®å½•ç»“æ„

```
guix/
â”œâ”€ guix/
â”‚  â”œâ”€ guix.rkt                 # ä¸»å…¥å£ï¼Œå¯¼å‡ºå…¬å…± API
â”‚  â”œâ”€ core/                    # æ ¸å¿ƒç³»ç»Ÿ
â”‚  â”‚  â”œâ”€ base-control.rkt      # æ§ä»¶åŸºç±»
â”‚  â”‚  â”œâ”€ event.rkt             # äº‹ä»¶ç³»ç»Ÿ
â”‚  â”‚  â”œâ”€ state.rkt             # çŠ¶æ€ç®¡ç†
â”‚  â”‚  â”œâ”€ layout.rkt            # å¸ƒå±€å¼•æ“
â”‚  â”‚  â””â”€ render.rkt            # æ¸²æŸ“è¾…åŠ©å·¥å…·
â”‚  â”œâ”€ style/                   # ä¸»é¢˜ç³»ç»Ÿ
â”‚  â”‚  â”œâ”€ theme.rkt             # ä¸»é¢˜æ¥å£
â”‚  â”‚  â”œâ”€ colors.rkt            # è‰²å½©å®šä¹‰
â”‚  â”‚  â”œâ”€ typography.rkt        # å­—ä½“è§„èŒƒ
â”‚  â”‚  â”œâ”€ metrics.rkt           # åº¦é‡ç³»ç»Ÿ
â”‚  â”‚  â””â”€ presets/
â”‚  â”‚     â”œâ”€ light.rkt
â”‚  â”‚     â””â”€ dark.rkt
â”‚  â”œâ”€ atomic/                  # åŸå­æ§ä»¶
â”‚  â”‚  â”œâ”€ button.rkt
â”‚  â”‚  â”œâ”€ checkbox.rkt
â”‚  â”‚  â”œâ”€ radio-button.rkt
â”‚  â”‚  â”œâ”€ text-field.rkt
â”‚  â”‚  â”œâ”€ icon.rkt
â”‚  â”‚  â””â”€ separator.rkt
â”‚  â”œâ”€ composite/               # ç»„åˆæ§ä»¶ï¼ˆæ•´ä½“äº¤äº’ï¼‰
â”‚  â”‚  â”œâ”€ list-item.rkt
â”‚  â”‚  â”œâ”€ tree-node.rkt
â”‚  â”‚  â”œâ”€ table-row.rkt
â”‚  â”‚  â””â”€ toolbar-item.rkt
â”‚  â”œâ”€ container/               # å®¹å™¨æ§ä»¶
â”‚  â”‚  â”œâ”€ panel.rkt
â”‚  â”‚  â”œâ”€ split-panel.rkt
â”‚  â”‚  â”œâ”€ tab-panel.rkt
â”‚  â”‚  â””â”€ scroll-panel.rkt
â”‚  â”œâ”€ view/                    # å¤æ‚è§†å›¾ç»„ä»¶
â”‚  â”‚  â”œâ”€ list-view.rkt
â”‚  â”‚  â”œâ”€ tree-view.rkt
â”‚  â”‚  â””â”€ table-view.rkt
â”‚  â”œâ”€ dialog/                  # å¯¹è¯æ¡†
â”‚  â”‚  â”œâ”€ message-box.rkt
â”‚  â”‚  â””â”€ input-dialog.rkt
â”‚  â”œâ”€ menu/                    # èœå•ç³»ç»Ÿ
â”‚  â”‚  â””â”€ context-menu.rkt
â”‚  â””â”€ extended/                # æ‰©å±•æ§ä»¶ï¼ˆå¯é€‰ï¼‰
â”‚     â”œâ”€ color-picker.rkt
â”‚     â””â”€ date-picker.rkt
â”œâ”€ tests/
â”œâ”€ examples/
â”‚  â”œâ”€ basic-controls.rkt
â”‚  â”œâ”€ theming.rkt
â”‚  â””â”€ todo-app.rkt
â””â”€ scribblings/
   â””â”€ guix.scrbl
```

### 3.2 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰©å±•æ§ä»¶ (extended)                  â”‚  å¯é€‰é«˜çº§åŠŸèƒ½
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¹è¯æ¡† (dialog) + èœå• (menu)        â”‚  ç‹¬ç«‹å­ç³»ç»Ÿ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¤æ‚è§†å›¾ (view)                      â”‚  list/tree/table
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®¹å™¨æ§ä»¶ (container)                 â”‚  å¸ƒå±€å®¹å™¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç»„åˆæ§ä»¶ (composite)                 â”‚  æ•´ä½“äº¤äº’å•å…ƒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸå­æ§ä»¶ (atomic)                    â”‚  åŸºç¡€äº¤äº’å•å…ƒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ¸å¿ƒç³»ç»Ÿ (core) + ä¸»é¢˜ (style)       â”‚  åŸºç¡€è®¾æ–½
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å››ã€æ ¸å¿ƒç³»ç»Ÿå®ç°

### 4.1 æ§ä»¶åŸºç±»

æ‰€æœ‰è‡ªç»˜æ§ä»¶ç»§æ‰¿è‡ª `guix-base-control%`ï¼Œä»¥ **canvas%** ä¸ºå”¯ä¸€è§†å›¾å®ä½“ã€‚

```racket
(define guix-base-control%
  (class canvas%
    (init-field [enabled? #t]
                [visible? #t]
                [theme (current-theme)]
                [min-width 0]
                [min-height 0])
    
    ;; çŠ¶æ€ç®¡ç†
    (define state 'normal) ; normal | hover | pressed | disabled
    
    ;; å…¬å…±æ¥å£
    (define/public (get-enabled) enabled?)
    (define/public (set-enabled e)
      (set! enabled? e)
      (set! state (if e 'normal 'disabled))
      (refresh))
    
    (define/public (get-state) state)
    
    ;; äº‹ä»¶å¤„ç†
    (define/override (on-event event)
      (when enabled?
        (handle-mouse-event event)
        (handle-keyboard-event event)))
    
    ;; æ¸²æŸ“å…¥å£
    (define/override (on-paint)
      (define dc (send this get-dc))
      (render-control dc state theme))
    
    ;; å­ç±»å¿…é¡»å®ç°
    (define/public (render-control dc state theme)
      (void))
    
    ;; è¾…åŠ©æ–¹æ³•
    (define/public (refresh)
      (send this refresh-now))
    
    (super-new [style '(no-focus)]
               [min-width min-width]
               [min-height min-height])))
```

### 4.2 äº‹ä»¶ç³»ç»Ÿ

#### 4.2.1 äº‹ä»¶æ¨¡å‹åŸåˆ™

**å…³é”®è®¤çŸ¥**

- racket/gui æ§ä»¶æ˜¯ç‹¬ç«‹çª—å£ï¼Œæ—  DOM å¼äº‹ä»¶å†’æ³¡
- åµŒå¥—æ§ä»¶ä¸ä¼šè‡ªåŠ¨åˆå¹¶å‘½ä¸­åŒºåŸŸ
- ç©ºç™½åŒºåŸŸä¸å“åº”äº‹ä»¶

**è®¾è®¡çº¦æŸ**

> ç”¨æˆ·è®¤ä¸ºæ˜¯"ä¸€ä¸ªæ•´ä½“"çš„æ§ä»¶ï¼š
> 
> - å¿…é¡»åªæœ‰ä¸€ä¸ª canvas%
> - åœ¨å†…éƒ¨å®ç° hit-test å’Œäº‹ä»¶åˆ†å‘
> - ç¦æ­¢ç”¨å¤šä¸ªåŸå­æ§ä»¶æ‹¼è£…

#### 4.2.2 æ”¯æŒçš„äº‹ä»¶ç±»å‹

```racket
;; åŸºç¡€äº‹ä»¶
(define-event-type on-click)          ; ç‚¹å‡»
(define-event-type on-hover-enter)    ; é¼ æ ‡è¿›å…¥
(define-event-type on-hover-exit)     ; é¼ æ ‡ç¦»å¼€
(define-event-type on-focus)          ; è·å¾—ç„¦ç‚¹
(define-event-type on-blur)           ; å¤±å»ç„¦ç‚¹

;; ç»„åˆæ§ä»¶ç‰¹æœ‰äº‹ä»¶
(define-event-type on-activate)       ; ä¸»æ“ä½œï¼ˆå¦‚åŒå‡»åˆ—è¡¨é¡¹ï¼‰
(define-event-type on-secondary)      ; æ¬¡çº§æ“ä½œï¼ˆå¦‚ç‚¹å‡»åˆ é™¤æŒ‰é’®ï¼‰
```

#### 4.2.3 å†…éƒ¨ hit-test ç¤ºä¾‹

```racket
(define (hit-test-regions x y width height)
  (cond
    [(< x 40) 'icon-region]
    [(> x (- width 60)) 'action-region]
    [else 'content-region]))
```

### 4.3 çŠ¶æ€ç®¡ç†

```racket
;; æ§ä»¶çŠ¶æ€
(define guix-state%
  (class object%
    (init-field [value #f]
                [on-change (Î» (v) (void))])
    
    (define/public (get) value)
    (define/public (set! new-value)
      (unless (equal? value new-value)
        (set! value new-value)
        (on-change new-value)))
    
    (super-new)))
```

### 4.4 å¸ƒå±€å¼•æ“

åŸºäº racket/gui çš„ panel ç³»ç»Ÿï¼Œæä¾›å¸¸ç”¨å¸ƒå±€è¾…åŠ©ï¼š

```racket
;; æ°´å¹³/å‚ç›´å¸ƒå±€
(define (hbox #:spacing [spacing 8] 
              #:alignment [alignment '(left center)]
              . children)
  ...)

;; ç½‘æ ¼å¸ƒå±€
(define (grid #:columns columns
              #:spacing [spacing 8]
              . children)
  ...)
```

## äº”ã€è§†è§‰ä¸ä¸»é¢˜ç³»ç»Ÿ

### 5.1 æ‰å¹³åŒ–è®¾è®¡è§„èŒƒ

#### 5.1.1 å½¢çŠ¶çº¦æŸ

- **åœ†è§’**ï¼šé»˜è®¤ 0pxï¼Œç‰¹æ®Šåœºæ™¯ â‰¤2px
- **è¾¹æ¡†**ï¼š1px å®çº¿ï¼Œæ— é˜´å½±
- **å±‚æ¬¡è¡¨è¾¾**ï¼šé€šè¿‡èƒŒæ™¯è‰²å·®å¼‚ï¼Œéé˜´å½±

#### 5.1.2 çŠ¶æ€è§†è§‰è§„èŒƒ

|çŠ¶æ€|è§†è§‰ç‰¹å¾|
|---|---|
|normal|é»˜è®¤èƒŒæ™¯è‰² + è¾¹æ¡†|
|hover|èƒŒæ™¯è‰²åŠ æ·± 5-10%|
|pressed|èƒŒæ™¯è‰²åŠ æ·± 15-20%|
|disabled|é™ä½ä¸é€æ˜åº¦è‡³ 40%|
|focused|æ·»åŠ  2px accent è‰²è¾¹æ¡†|

### 5.2 ä¸»é¢˜ç»“æ„

```racket
(define-theme light-theme
  #:colors (hash
    'bg-primary "#FFFFFF"
    'bg-secondary "#F5F5F5"
    'border "#CCCCCC"
    'text-primary "#000000"
    'text-secondary "#666666"
    'accent "#007AFF"
    'danger "#FF3B30"
    'success "#34C759")
  
  #:metrics (hash
    'corner-radius 0
    'border-width 1
    'padding 8
    'spacing 8
    'icon-size 16
    'line-height 1.4)
  
  #:typography (hash
    'font-family "system-ui"
    'font-size 13
    'font-weight 'normal))
```

### 5.3 è‰²å½©ç³»ç»Ÿ

```racket
;; è¯­ä¹‰åŒ–é¢œè‰²
(define (theme-color theme key [fallback "#000000"])
  (hash-ref (theme-colors theme) key fallback))

;; è‡ªåŠ¨ç”Ÿæˆ hover/pressed è‰²
(define (darken-color color percent)
  ...)
```

## å…­ã€æ§ä»¶åˆ†ç±»ä¸å®ç°ç­–ç•¥

### 6.1 æ§ä»¶åˆ†ç±»æ ‡å‡†

#### A. åŸå­æ§ä»¶ï¼ˆAtomicï¼‰

**å®šä¹‰**ï¼šå•ä¸€äº¤äº’è¯­ä¹‰ï¼Œæ— å­åŒºåŸŸå·®å¼‚å“åº”

**ç‰¹å¾**

- æ•´ä¸ªåŒºåŸŸå“åº”ç›¸åŒäº‹ä»¶
- æ— å†…éƒ¨å¤æ‚ hit-test
- å¯è‡ªç»˜æˆ–è½»åº¦å°è£… racket/gui åŸç”Ÿæ§ä»¶

**ç¤ºä¾‹**

- button%ï¼šæ•´ä½“å¯ç‚¹å‡»
- checkbox%ï¼šå•ä¸€åˆ‡æ¢
- icon%ï¼šçº¯å±•ç¤º
- separator%ï¼šçº¯è£…é¥°

**å®ç°æ–¹å¼**

```racket
;; è‡ªç»˜ç¤ºä¾‹
(define guix-button%
  (class guix-base-control%
    (init-field [label "Button"]
                [on-click void])
    
    (define/override (render-control dc state theme)
      (draw-button-background dc state theme)
      (draw-button-text dc label theme))
    
    (define/override (on-event event)
      (when (eq? (send event get-event-type) 'left-up)
        (on-click)))
    
    (super-new)))
```

#### B. å®¹å™¨æ§ä»¶ï¼ˆContainerï¼‰

**å®šä¹‰**ï¼šä»…è´Ÿè´£å¸ƒå±€å’Œå­æ§ä»¶ç»„ç»‡ï¼Œæ— æ•´ä½“äº¤äº’è¯­ä¹‰

**ç‰¹å¾**

- å­æ§ä»¶ç‹¬ç«‹å“åº”äº‹ä»¶
- å®¹å™¨æœ¬èº«æ— ä¸šåŠ¡é€»è¾‘
- å¯ç”¨åŸç”Ÿ panel% æˆ–è‡ªå®šä¹‰å¸ƒå±€

**ç¤ºä¾‹**

- panel%ï¼šåŸºç¡€å®¹å™¨
- split-panel%ï¼šå¯è°ƒæ•´åˆ†éš”
- tab-panel%ï¼šæ ‡ç­¾é¡µåˆ‡æ¢
- scroll-panel%ï¼šæ»šåŠ¨å®¹å™¨

**å®ç°æ–¹å¼**

```racket
;; å°è£… racket/gui
(define guix-panel%
  (class vertical-panel%
    (init-field [spacing 8]
                [padding 8])
    
    (super-new [border padding]
               [spacing spacing])))
```

#### C. æ•´ä½“äº¤äº’æ§ä»¶ï¼ˆCompositeï¼‰

**å®šä¹‰**ï¼šç”¨æˆ·è®¤ä¸ºæ˜¯"ä¸€ä¸ªæ•´ä½“"ï¼Œä½†å†…éƒ¨æœ‰å¤šä¸ªå¯äº¤äº’åŒºåŸŸ

**å…³é”®ç‰¹å¾**

- âš ï¸ **å¿…é¡»ç”¨å•ä¸€ canvas% è‡ªç»˜**
- å†…éƒ¨å®ç° hit-test åŒºåŸŸåˆ’åˆ†
- ä¸åŒåŒºåŸŸè§¦å‘ä¸åŒå›è°ƒ
- æ•´ä½“å“åº” hover çŠ¶æ€

**ç¤ºä¾‹**

- list-item%ï¼šæ•´è¡Œå¯é€‰ä¸­ï¼Œä½†åˆ é™¤æŒ‰é’®ç‹¬ç«‹ç‚¹å‡»
- tree-node%ï¼šå±•å¼€æŒ‰é’® + å†…å®¹åŒºåŸŸ
- table-row%ï¼šæ•´è¡Œ hoverï¼Œå•å…ƒæ ¼å¯ç¼–è¾‘
- toolbar-item%ï¼šå›¾æ ‡ + ä¸‹æ‹‰èœå•

**é”™è¯¯åšæ³•**

```racket
;; âŒ é”™è¯¯ï¼šç”¨å¤šä¸ªæ§ä»¶æ‹¼è£…
(define wrong-list-item%
  (new horizontal-panel%
       [children (list
                  (new label% [label icon])
                  (new label% [label text])
                  (new button% [label "Delete"]))]))
;; é—®é¢˜ï¼šæ— æ³•å®ç°æ•´è¡Œ hoverï¼Œç©ºç™½åŒºåŸŸä¸å“åº”ç‚¹å‡»
```

**æ­£ç¡®åšæ³•**

```racket
;; âœ… æ­£ç¡®ï¼šå• canvas è‡ªç»˜
(define guix-list-item%
  (class guix-base-control%
    (init-field [text "Item"]
                [icon #f]
                [on-click void]
                [on-delete void])
    
    (define delete-button-rect #f)
    
    (define/override (render-control dc state theme)
      ;; ç»˜åˆ¶æ•´ä½“èƒŒæ™¯
      (when (member state '(hover pressed selected))
        (draw-background dc state))
      
      ;; ç»˜åˆ¶å›¾æ ‡
      (when icon
        (draw-icon dc icon 8 (/ height 2)))
      
      ;; ç»˜åˆ¶æ–‡æœ¬
      (draw-text dc text 40 (/ height 2))
      
      ;; ç»˜åˆ¶åˆ é™¤æŒ‰é’®ï¼ˆè®°å½•åŒºåŸŸï¼‰
      (set! delete-button-rect (make-rect (- width 50) 5 40 height))
      (draw-delete-button dc delete-button-rect))
    
    (define/override (on-event event)
      (define x (send event get-x))
      (define y (send event get-y))
      
      (when (eq? (send event get-event-type) 'left-up)
        (if (point-in-rect? x y delete-button-rect)
            (on-delete)
            (on-click))))
    
    (super-new [min-height 32])))
```

### 6.2 å®ç°ç­–ç•¥å†³ç­–æ ‘

```
æ§ä»¶éœ€æ±‚
  â”œâ”€ å•ä¸€äº¤äº’è¯­ä¹‰ï¼Ÿ
  â”‚   â””â”€ YES â†’ åŸå­æ§ä»¶ â†’ å¯è‡ªç»˜æˆ–å°è£…
  â”‚
  â”œâ”€ ä»…å¸ƒå±€å­æ§ä»¶ï¼Ÿ
  â”‚   â””â”€ YES â†’ å®¹å™¨æ§ä»¶ â†’ å¯æ‹¼è£…
  â”‚
  â””â”€ ç”¨æˆ·è§†ä¸ºæ•´ä½“ï¼Œä½†å†…éƒ¨æœ‰å¤šåŒºåŸŸï¼Ÿ
      â””â”€ YES â†’ æ•´ä½“äº¤äº’æ§ä»¶ â†’ **å¿…é¡»è‡ªç»˜**
```

## ä¸ƒã€æ§ä»¶æ¸…å•

### 7.1 åŸå­æ§ä»¶ï¼ˆatomic/ï¼‰

|æ§ä»¶|å®ç°æ–¹å¼|ä¼˜å…ˆçº§|
|---|---|---|
|button%|è‡ªç»˜|P0|
|checkbox%|è‡ªç»˜|P0|
|radio-button%|è‡ªç»˜|P0|
|text-field%|å°è£… racket/gui|P0|
|icon%|è‡ªç»˜|P0|
|separator%|è‡ªç»˜|P1|
|label%|å°è£… racket/gui|P1|

### 7.2 ç»„åˆæ§ä»¶ï¼ˆcomposite/ï¼‰

|æ§ä»¶|å®ç°æ–¹å¼|è¯´æ˜|
|---|---|---|
|list-item%|**å• canvas è‡ªç»˜**|æ•´è¡Œ hover + åˆ é™¤æŒ‰é’®|
|tree-node%|**å• canvas è‡ªç»˜**|å±•å¼€ç¬¦å· + å†…å®¹|
|table-row%|**å• canvas è‡ªç»˜**|æ•´è¡Œé€‰ä¸­ + å•å…ƒæ ¼ç¼–è¾‘|
|toolbar-item%|**å• canvas è‡ªç»˜**|å›¾æ ‡ + å¯é€‰ä¸‹æ‹‰|

### 7.3 å®¹å™¨æ§ä»¶ï¼ˆcontainer/ï¼‰

|æ§ä»¶|å®ç°æ–¹å¼|ä¼˜å…ˆçº§|
|---|---|---|
|panel%|å°è£… racket/gui|P0|
|split-panel%|è‡ªç»˜åˆ†éš”æ¡ + å°è£…|P1|
|tab-panel%|è‡ªç»˜æ ‡ç­¾æ  + å°è£…|P1|
|scroll-panel%|å°è£… racket/gui|P1|

### 7.4 å¤æ‚è§†å›¾ï¼ˆview/ï¼‰

|æ§ä»¶|å®ç°æ–¹å¼|ä¼˜å…ˆçº§|
|---|---|---|
|list-view%|è‡ªç»˜è™šæ‹Ÿæ»šåŠ¨|P1|
|tree-view%|è‡ªç»˜æ ‘å½¢ç»“æ„|P2|
|table-view%|è‡ªç»˜è¡¨æ ¼|P2|

## å…«ã€ä¸ºä»€ä¹ˆä¸é‡‡ç”¨ HTML å¼åµŒå¥—

### 8.1 å¯¹æ¯”åˆ†æ

#### HTML/æµè§ˆå™¨æ¨¡å‹

- âœ… é€»è¾‘æ ‘ â‰ˆ æ¸²æŸ“æ ‘
- âœ… äº‹ä»¶è‡ªåŠ¨å†’æ³¡
- âœ… é€æ˜èƒŒæ™¯å¯å åŠ 
- âœ… å‘½ä¸­åŒºåŸŸè‡ªåŠ¨åˆå¹¶
- ğŸ’¡ é€‚åˆï¼š`<div class="card"><button>Delete</button></div>`

#### racket/gui æ¨¡å‹

- âŒ æ§ä»¶ = ç‹¬ç«‹çª—å£
- âŒ æ— äº‹ä»¶å†’æ³¡
- âŒ æ— é€æ˜è£å‰ª
- âŒ ç©ºç™½åŒºåŸŸä¸å“åº”äº‹ä»¶
- ğŸ’¡ å¿…é¡»ï¼šå• canvas + å†…éƒ¨ hit-test

### 8.2 å®é™…å½±å“

**åœºæ™¯**ï¼šå®ç°ä¸€ä¸ªå¯åˆ é™¤çš„åˆ—è¡¨é¡¹

```
HTML æ–¹å¼ï¼ˆä¸é€‚ç”¨äº racket/guiï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Icon] Item Text   [Delete]â”‚  â† æ•´ä¸ª div å“åº” hover
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ ç‚¹å‡»ç©ºç™½å¤„è§¦å‘ item click
  â†“ ç‚¹å‡» Delete è§¦å‘ button click

racket/gui æ‹¼è£…æ–¹å¼ï¼ˆé”™è¯¯ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Icon] Item Text   [Delete]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ ç‚¹å‡»ç©ºç™½å¤„ï¼šæ— å“åº” âŒ
  â†“ åªæœ‰ button åŒºåŸŸå¯ç‚¹å‡»
  â†“ æ— æ³•å®ç°æ•´è¡Œ hover

racket/gui æ­£ç¡®æ–¹å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•ä¸€ canvas%               â”‚
â”‚  å†…éƒ¨ hit-test:            â”‚
â”‚   - 0~40px: icon           â”‚
â”‚   - 40~width-60: content   â”‚
â”‚   - width-60~width: delete â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  âœ… æ•´è¡Œå“åº” hover
  âœ… ä¸åŒåŒºåŸŸè§¦å‘ä¸åŒå›è°ƒ
```

### 8.3 ç»“è®º

> **åœ¨ racket/gui ä¸­ï¼Œå¤æ‚äº¤äº’æ§ä»¶åªæœ‰ä¸€æ¡æ­£ç¡®é“è·¯ï¼š  
> è‡ªç»˜æ•´ä½“ + å†…éƒ¨äº‹ä»¶åˆ†å‘**

## ä¹ã€å¼€å‘è§„èŒƒ

### 9.1 å‘½åçº¦å®š

```racket
;; æ§ä»¶ç±»ï¼šguix-<name>%
(define guix-button% ...)

;; è¾…åŠ©å‡½æ•°ï¼š<context>-<action>
(define (theme-get-color theme key) ...)

;; äº‹ä»¶å›è°ƒï¼šon-<event>
(init-field [on-click void])
```

### 9.2 æ–‡æ¡£è¦æ±‚

æ¯ä¸ªæ§ä»¶æä¾›ï¼š

- ç®€è¦è¯´æ˜
- åˆå§‹åŒ–å‚æ•°åˆ—è¡¨
- å…¬å…±æ–¹æ³•
- äº‹ä»¶å›è°ƒ
- ä½¿ç”¨ç¤ºä¾‹

### 9.3 æµ‹è¯•è¦æ±‚

- å•å…ƒæµ‹è¯•ï¼šæ ¸å¿ƒé€»è¾‘
- é›†æˆæµ‹è¯•ï¼šæ§ä»¶ç»„åˆ
- è§†è§‰æµ‹è¯•ï¼šä¸»é¢˜åˆ‡æ¢
- è·¨å¹³å°æµ‹è¯•ï¼šmacOS/Windows/Linux

## åã€ç‰ˆæœ¬è§„åˆ’

### v0.1ï¼ˆåŸºç¡€ï¼‰

- æ ¸å¿ƒç³»ç»Ÿ
- åŸºç¡€ä¸»é¢˜
- 5ä¸ªåŸå­æ§ä»¶

### v0.2ï¼ˆæ‰©å±•ï¼‰

- å®¹å™¨æ§ä»¶
- 3ä¸ªç»„åˆæ§ä»¶
- æš—è‰²ä¸»é¢˜

### v0.3ï¼ˆå®Œå–„ï¼‰

- å¤æ‚è§†å›¾
- å¯¹è¯æ¡†
- å®Œæ•´æ–‡æ¡£

### v1.0ï¼ˆç¨³å®šï¼‰

- API ç¨³å®š
- å®Œæ•´æµ‹è¯•
- æœ€ä½³å®è·µæŒ‡å—

## åä¸€ã€æ€»ç»“

### æ ¸å¿ƒç†å¿µ

1. **æŠ€æœ¯ç†æ€§**ï¼šguix ä¸æ˜¯ HTML GUIï¼ŒåŸºäº racket/gui ç°å®
2. **è§†è§‰å…‹åˆ¶**ï¼šæ‰å¹³é£æ ¼æ˜¯æŠ€æœ¯é€‰æ‹©ï¼Œéå®¡ç¾å¦¥å
3. **å®ç°æ˜ç¡®**ï¼š"æ•´å—å“åº”"æ§ä»¶å¿…é¡»è‡ªç»˜ï¼Œæ‹¼è£…ä»…é€‚åˆå¸ƒå±€
4. **è¡Œä¸ºä¼˜å…ˆ**ï¼šè·¨å¹³å°äº¤äº’ä¸€è‡´æ€§é«˜äºè§†è§‰ç»Ÿä¸€

### å…³é”®çº¦æŸ

- æ•´ä½“äº¤äº’æ§ä»¶ = å• canvas% + å†…éƒ¨ hit-test
- æ‰å¹³è®¾è®¡ = â‰¤2px åœ†è§’ + æ— é˜´å½±
- äº‹ä»¶æ¨¡å‹ â‰  DOM å†’æ³¡
- é€æ˜è£å‰ªä¸å­˜åœ¨

### æˆåŠŸæ ‡å‡†

- å¼€å‘è€…èƒ½å¿«é€Ÿç†è§£æ§ä»¶é€‰æ‹©å’Œå®ç°ç­–ç•¥
- è·¨å¹³å°è¡Œä¸ºå®Œå…¨ä¸€è‡´
- ä¸»é¢˜åˆ‡æ¢æ— ç¼æµç•…
- ä»£ç å¯ç»´æŠ¤ã€å¯æ‰©å±•